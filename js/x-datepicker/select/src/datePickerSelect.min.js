jQuery.fn.extend({datePickerSelect:function(b){var a={},d={},c={};a.gcaches={};a.isleap=function(e){return e&&((e%4===0&&e%100!==0)||e%400===0)};a.splitDates=function(e){if(!e){return[]}if(a.gcaches[e]){return a.gcaches[e]}var f=e.split("-");for(var g=0;g<f.length;g++){f[g]=parseInt(f[g])||0}a.gcaches[e]=f;return f};a.values={min_year:function(f){var g=a.splitDates(f.min_date),e=new Date();return g[0]||e.getFullYear()},max_year:function(f){var g=a.splitDates(f.max_date),e=new Date();return g[0]||e.getFullYear()+1},min_month:function(f){var e=1,g=a.splitDates(f.min_date);if(g[1]&&(g[0]==f.year)){e=parseInt(g[1])||1}return e},max_month:function(e){var f=null,g=12;f=a.splitDates(e.max_date);if(f[1]&&(f[0]==e.year)){g=parseInt(f[1])||12}return g},min_day:function(e){a.values.set_leap_year(e);var f=null,g=1;f=a.splitDates(e.min_date);if(f[0]==e.year&&f[1]==e.month){g=parseInt(f[2])||1}return g},max_day:function(f){a.values.set_leap_year(f);var g=null,e=f.days[f.month]||12;g=a.splitDates(f.max_date);if(g[0]==f.year&&g[1]==f.month){e=parseInt(g[2])||1}return e},set_leap_year:function(e){if(a.isleap(e.year)){e.days[2]=29}}};a.getYears=function(e){var f=null,j={},g=a.values.min_year(e),h=a.values.max_year(e);for(var i=g;i<=h;i++){j[i]=i}return j};a.getMonths=function(f){var h=null,g={},e=a.values.min_month(f),j=a.values.max_month(f);for(var i=e;i<=j;i++){g[i]=i}return g};a.getDays=function(f){var i=a.values.min_day(f),e=a.values.max_day(f);var g={};for(var h=i;h<=e;h++){g[h]=h}return g};d.ObjectToLabelHtml=function(e,j,k){var h=[],f=new d.easyTemplate(e);if(!$.isEmptyObject(j)){for(var g in j){h.push(f({value:g,title:j[g],selected:k}).toString())}}return h.length?h.join(""):""};d.easyTemplate=function(h,j){if(!h){return""}var g=function(k){var m=/\\'/g;var l=k.replace(/(<(\/?)#(.*?(?:\(.*?\))*)>)|(')|([\r\n\t])|(\$\{([^\}]*?)\})/g,function(o,n,u,t,s,r,q,p){if(n){return"{|}"+(u?"@":"+")+t+"{|}"}if(s){return"\\'"}if(r){return""}if(q){return"'+("+p.replace(m,"'")+")+'"}});return l};var f=function(v){var u,m,p,l,o,n,q,t=["var aRet = [];"];q=v.split(/\{\|\}/);var k=/\s/;while(q.length){p=q.shift();if(!p){continue}o=p.charAt(0);if(o!=="+"&&o!=="@"){p="'"+p+"'";t.push("aRet.push("+p+");");continue}l=p.split(k);switch(l[0]){case"+et":u=l[1];m=l[2];break;case"@et":break;case"+if":l.splice(0,1);t.push("if"+l.join(" ")+"{");break;case"+elseif":l.splice(0,1);t.push("}else if"+l.join(" ")+"{");break;case"@if":t.push("}");break;case"+else":t.push("}else{");break;default:break}}t.push('return aRet.join("");');return[m,t.join("")]};if(h!==this.template){this.template=h;this.aStatement=f(g(h))}var e=this.aStatement;var i=function(k){if(k){j=k}return arguments.callee};i.toString=function(){return(new Function(e[0],e[1]))(j)};return i};d.setResult=function(g,e){var f=$(g).find("input[type=hidden]:eq(0)");f.val(d.easyTemplate(e.resultTpl,e).toString());return true};d.initDatePickerHtml=function(f,e){var g={};g.name=e.name;g.year=(e.formatResult[0]=="Y")?d.ObjectToLabelHtml(e.labelTpl,a.getYears(e),e.year):"";g.month=(e.formatResult[1]=="m")?d.ObjectToLabelHtml(e.labelTpl,a.getMonths(e),e.month):"";g.day=(e.formatResult[2]=="d")?d.ObjectToLabelHtml(e.labelTpl,a.getDays(e),e.day):"";datePickerHtml=d.easyTemplate(e.tpl,g).toString();$(f).html(datePickerHtml);d.setResult(f,e);return true};c.initChangeEvent=function(g,f){try{$(g.find(f.year_node)).on(f.event_type,function(){f.year=$(this).val();f.month=a.values.min_month(f);if(f.formatResult[2]){f.day=a.values.min_day(f)}d.initDatePickerHtml(g,f);c.initChangeEvent(g,f)})}catch(h){}try{$(g.find(f.month_node)).on(f.event_type,function(){f.month=$(this).val();if(f.formatResult[2]){f.day=a.values.min_day(f)}d.initDatePickerHtml(g,f);c.initChangeEvent(g,f)})}catch(h){}try{$(g.find(f.day_node)).on(f.event_type,function(){f.day=$(this).val();d.initDatePickerHtml(g,f);c.initChangeEvent(g,f)})}catch(h){}};return this.each(function(){var f={format:"Y-m",days:[null,31,28,31,30,31,30,31,31,30,31,30,31],year_node:".date_picker:eq(0)",month_node:".date_picker:eq(1)",day_node:".date_picker:eq(2)",event_type:"change",min_date:"",max_date:"",date:"",year:0,month:0,day:1,resultTpl:"<#et date_result datas>${datas.year}-${datas.month}<#if (datas.day) >-${datas.day}</#if></#et>",labelTpl:'<#et date_picker_label datas><option value="${datas.value}" <#if (datas.value==datas.selected)>selected</#if>>${datas.title}</option></#et>',tpl:'<#et date_picker datas><input type="hidden" name="${datas.name}" value=""/><select class="date_picker">${datas.year}</select><br/><select class="date_picker">${datas.month}</select> <#if (datas.day) ><br/> <select class="date_picker">${datas.day}</select></#if></#et>'};b=b||{};$.extend(f,b);var g=$(this),e=g.data()||{};$.extend(f,e);f.formatResult=f.format.split("-")||[];f.year=a.values.min_year(f);f.month=a.values.min_month(f);f.day=a.values.min_day(f);d.initDatePickerHtml(g,f);c.initChangeEvent(g,f);return true})}});